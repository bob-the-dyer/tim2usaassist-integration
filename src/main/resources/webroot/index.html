<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head lang="en">
    <meta charset="UTF-8">
    <title>USA-ASSIST Integration</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
</head>
<body>
<div class="well">

    <p/> Plan:
    <select id="plan_code">
        <option value="STD">STD</option>
        <option value="EXE">EXE</option>
        <option value="GLD">GLD</option>
        <option value="PLT">PLT</option>
        <option value="TNM">TNM</option>
        <option value="DMD">DMD</option>
    </select>

    <p/> Subscriber Country of Residence: <input type="text" id="country_code" value="US"/> (2 symbols)
    <p/> Subscriber province or state: <input type="text" id="state" value="Texas"/> (50 symbols)
    <p/> Subscriber city: <input type="text" id="city" value="Austin"/> (50 symbols)
    <p/> Subscriber address: <input type="text" id="address" value="Colorado st, 27"/> (70 symbols)
    <p/> Subscriber zip code/postal code: <input type="text" id="zip_code" value="12345654321"/> (15 symbols)
    <p/> Subscriber phone: <input type="text" id="phone" value="123456780"/>

    <p/> Subscriber Email: <input type="text" id="email" value="bob@tim.com"/> (100 symbols)
    <p/> Primary country of destination: <input type="text" id="destination_code" value="AU"/> (2 symbols)
    <p/> Effective date/Departure date: <input type="text" id="start" value="2015-10-01"/> (YYYY-MM-DD)
    <p/> Expiration date/Return date: <input type="text" id="end" value="2015-10-14"/> (YYYY-MM-DD)
    <p/> Number of travelers: <input type="text" id="travelers" value="2"/> (Maximum 8 travelers under same policy
    transaction)
    <p/> Trip cost per Traveler: <input type="text" id="trip_cost" value="1000"/> (1 to 20000)
    <p/><!--TODO how to pass an array-->
    <p/> First name for each traveler: <input type="text" id="first_name1" value="Vladimir"/><input type="text" id="first_name2" value="Valentina"/> (Array of String 50)
    <p/> Last name for each traveler: <input type="text" id="last_name1" value="Krasilschik"/><input type="text" id="last_name2" value="Krasilschik"/> (Array of String 50)
    <p/> Date of birth for each traveler: <input type="text" id="dob1" value="1990-01-01"/><input type="text" id="dob2" value="1990-01-01"/> (Array of Date, YYYY-MM-DD)
    <p/> Passport number for each traveler: <input type="text" id="passport1" value="29374890142"/><input type="text" id="passport2" value="2923450142"/> (Array of String 20)
    <p/> Relationship for each traveler: <input type="text" id="relationship1" value="1"/><input type="text" id="relationship2" value="2"/> (Array of Integer)
    <p/>

    <p/> Card number: <input type="text" id="card_num" value="5424000000000015"/> (Integer)
    <p/> Card expiration date: <input type="text" id="card_exp" value="03/2017"/> (MM/YYYY)
    <p/> Card Code Verification: <input type="text" id="card_code" value="123"/> (Integer)
    <p/> Card holder first name: <input type="text" id="card_fname" value="Bob"/> (String 50)
    <p/> Card holder last name: <input type="text" id="card_lname" value="Dyer"/> (String 50)
    <p/> Zip/Postal code of card holder billing statement: <input type="text" id="card_zip" value="124356"/> (String 20)
    <p/> IP address reference of customer: <input type="text" id="customer_ip" value="255.255.255.255"/> (String)
    <p/> Total amount for all travelers: <input type="text" id="total" value="350.04"/> (Decimal (2))
    <p/>

    <p/>
    <button type="button" class="btn btn-default" onclick="sendRequest()">Submit</button>
    <div class="disabled" id="progress">
        <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar"
             aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
        </div>
    </div>
    <p/>Receipt: <input type="text" disabled id="receipt"/>

    <p/>Certificate: <input type="text" disabled id="certificate"/>

    <p/>Total: <input type="text" disabled id="totalAmount"/>

    <p/>Status: <input type="text" disabled id="status"/>

    <p/>Transaction: <input type="text" disabled id="transaction"/>

    <p/>UUID: <input type="text" disabled id="uuid"/>

    <p/>Error - action: <input type="text" disabled id="error.action"/>,
    key: <input type="text" disabled id="error.key"/>,
    value: <input type="text" disabled id="error.value"/>,
    text: <input type="text" disabled id="error.text" size="60"/>
    <p/>Delay: <input type="text" disabled id="delay"/>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script type="text/javascript" src="js3rdparty/jquery.min.js"></script>
<script type="text/javascript" src="js3rdparty/bootstrap.min.js"></script>
<!--<script type="text/javascript" src="js3rdparty/angular.min.js"></script>-->
<script type="text/javascript" src="js3rdparty/sockjs-0.3.4.min.js"></script>
<script type="text/javascript" src='js3rdparty/vertxbus.js'></script>
<!--<script type="text/javascript" src="js/app.js"></script>-->
<script>
    var eb;
    if (eb != null) {
        console.log("socket was opened, closing");
        eb.close();
    }
    eb = new vertx.EventBus('/eventbus');
    eb.onopen = function () {
        console.log("opening socket");
    };
    eb.onclose = function () {
        console.log("closing socket");
        eb = null;
    };

    function ifexists(value) {
        if (value == null) {
            return ''
        } else {
            return value;
        }
    }
    function sendRequest() {
        document.getElementById('progress').className = "progress";
        document.getElementById('receipt').value = '';
        document.getElementById('certificate').value = '';
        document.getElementById('totalAmount').value = '';
        document.getElementById('error.key').value = '';
        document.getElementById('error.value').value = '';
        document.getElementById('error.action').value = '';
        document.getElementById('error.text').value = '';
        document.getElementById('delay').value = '';
        document.getElementById('status').value = '';
        document.getElementById('transaction').value = '';
        document.getElementById('uuid').value = '';
        var jsonObject = JSON;
        jsonObject.plan_code = document.getElementById('plan_code').value;
        jsonObject.country_code = document.getElementById('country_code').value;
        jsonObject.state = document.getElementById('state').value;
        jsonObject.city = document.getElementById('city').value;
        jsonObject.address = document.getElementById('address').value;
        jsonObject.zip_code = document.getElementById('zip_code').value;
        jsonObject.phone = document.getElementById('phone').value;
        jsonObject.email = document.getElementById('email').value;
        jsonObject.destination_code = document.getElementById('destination_code').value;
        jsonObject.start = document.getElementById('start').value;
        jsonObject.end = document.getElementById('end').value;
        jsonObject.travelers = document.getElementById('travelers').value;
        jsonObject.trip_cost = document.getElementById('trip_cost').value;
        jsonObject.first_name = [];
        jsonObject.first_name[0] = document.getElementById('first_name1').value;
        jsonObject.first_name[1] = document.getElementById('first_name2').value;
        jsonObject.last_name = [];
        jsonObject.last_name[0] = document.getElementById('last_name1').value;
        jsonObject.last_name[1] = document.getElementById('last_name2').value;
        jsonObject.dob = [];
        jsonObject.dob[0] = document.getElementById('dob1').value;
        jsonObject.dob[1] = document.getElementById('dob2').value;
        jsonObject.passport = [];
        jsonObject.passport[0] = document.getElementById('passport1').value;
        jsonObject.passport[1] = document.getElementById('passport2').value;
        jsonObject.relationship = [];
        jsonObject.relationship[0] = document.getElementById('relationship1').value;
        jsonObject.relationship[1] = document.getElementById('relationship2').value;
        jsonObject.card_num = document.getElementById('card_num').value;
        jsonObject.card_num = document.getElementById('card_num').value;
        jsonObject.card_exp = document.getElementById('card_exp').value;
        jsonObject.card_code = document.getElementById('card_code').value;
        jsonObject.card_fname = document.getElementById('card_fname').value;
        jsonObject.card_lname = document.getElementById('card_lname').value;
        jsonObject.card_zip = document.getElementById('card_zip').value;
        jsonObject.customer_ip = document.getElementById('customer_ip').value;
        jsonObject.total = document.getElementById('totalAmount').value;
        eb.send('request', jsonObject, function (msg) {
            console.log('received a message: ' + msg);
            document.getElementById('receipt').value = ifexists(msg.receipt);
            document.getElementById('certificate').value = ifexists(msg.certificate);
            document.getElementById('totalAmount').value = ifexists(msg.total);
            document.getElementById('delay').value = ifexists(msg.delay);
            document.getElementById('status').value = ifexists(msg.status);
            document.getElementById('transaction').value = ifexists(msg.transaction);
            document.getElementById('uuid').value = ifexists(msg.uuid);
            if (msg.error != null) {
                document.getElementById('error.key').value = ifexists(msg.error.key);
                document.getElementById('error.action').value = ifexists(msg.error.action);
                document.getElementById('error.value').value = ifexists(msg.error.value);
                document.getElementById('error.text').value = ifexists(msg.error.text);
            }
            document.getElementById('progress').className = "disabled";
        });
    }
</script>
</body>
</html>